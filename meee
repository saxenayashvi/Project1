page1.py
import streamlit as st
from pathlib import Path

# ---------------- PAGE CONFIG (must be first) ----------------
st.set_page_config(
    page_title="BI4BI - EY Landing Page",
    layout="wide",
    initial_sidebar_state="collapsed",
)

# ---------------- LOAD CSS (by page) ----------------
def load_css(file_path: Path) -> None:
    if file_path.exists():
        with file_path.open("r", encoding="utf-8") as f:
            st.markdown(f"<style>{f.read()}</style>", unsafe_allow_html=True)

BASE = Path(__file__).parent

# ---------------- SESSION STATE: which page to show ----------------
if "page" not in st.session_state:
    st.session_state["page"] = "home"

# Navigate to Choose Tool when "Begin" link is clicked (query param)
if st.query_params.get("page") == "choose_tool" and st.session_state.get("page") != "choose_tool":
    st.session_state["page"] = "choose_tool"
    st.query_params.clear()
    st.rerun()

current_page = st.session_state["page"]

# Load the unified CSS for all pages
load_css(BASE / "merged-styles.css")

# ---------------- RENDER: LANDING PAGE (BI4BI) – single HTML card (rectangle) ----------------
if current_page == "home":
    st.markdown('<div class="center-wrapper">', unsafe_allow_html=True)

    col_left, col_center, col_right = st.columns([1, 2.5, 1])

    with col_center:
        # Entire card as ONE div so we control shape (strict rectangle)
        st.markdown(
            """
            <div class="landing-card">
                <div class="title">BI4BI</div>
                <div class="desc">
                    BI4BI helps analyze existing BI reports, identify redundancies,
                    and provide recommendations to rationalize and modernize<br>
                    legacy BI environments using metadata-driven insights.
                </div>
                <!-- Begin link removed; Streamlit button below renders in-place -->
                <div class="footer">©️ 2024 EYGM Limited. All Rights Reserved.</div>
            </div>
            """,
            unsafe_allow_html=True,
        )
        if st.button("Begin →"):
            st.session_state["page"] = "choose_tool"
            st.rerun()
    st.markdown("</div>", unsafe_allow_html=True)

# ---------------- RENDER: CHOOSE TOOL PAGE ----------------
elif current_page == "choose_tool":
    st.markdown("# Choose Tool")
    col1, col2, col3 = st.columns(3)
    with col1:
        if st.button("Tableau"):
            st.session_state["selected_tool"] = "Tableau"
            st.session_state["page"] = "configure"
            st.rerun()
    with col2:
        if st.button("Oracle"):
            st.session_state["selected_tool"] = "Oracle"
            st.session_state["page"] = "configure"
            st.rerun()
    with col3:
        if st.button("Power BI"):
            st.session_state["selected_tool"] = "Power BI"
            st.session_state["page"] = "configure"
            st.rerun()

    col4, col5, col6 = st.columns(3)
    with col4:
        if st.button("SAP"):
            st.session_state["selected_tool"] = "SAP"
            st.session_state["page"] = "configure"
            st.rerun()
    with col5:
        if st.button("Qlik"):
            st.session_state["selected_tool"] = "Qlik"
            st.session_state["page"] = "configure"
            st.rerun()
    with col6:
        if st.button("Looker"):
            st.session_state["selected_tool"] = "Looker"
            st.session_state["page"] = "configure"
            st.rerun()

    if st.session_state.get("selected_tool"):
        st.success(f"You selected **{st.session_state['selected_tool']}**")

# ---------------- RENDER: CONFIGURE PAGE ----------------
elif current_page == "configure":
    # Render configure UI as a fresh page: do NOT show other tool buttons here.
    from frontend.tab_configure_app import render_configure_page

    selected_tool = st.session_state.get("selected_tool", "Tableau")
    render_configure_page(selected_tool)

else:
    # Fallback: go back to home
    st.session_state["page"] = "home"
    st.rerun()


tab_configure app.py

import os
import streamlit as st
import requests
import pandas as pd
from core.config import BACKEND_URL, CREDENTIALS_PATH

# NOTE: this module exposes a callable function `render_configure_page(selected_tool)`
# so the configuration UI can be embedded in other pages without creating a new Streamlit page.


def _load_saved_credentials():
    cred_path = os.path.abspath(CREDENTIALS_PATH)
    server_saved = None
    api_version_saved = '3.17'
    token_name_saved = None
    token_secret_saved = None
    site_name_saved = ''
    if os.path.exists(cred_path):
        try:
            df = pd.read_csv(cred_path)
            row = df.iloc[0]
            server_saved = row.get('server_saved')
            api_version_saved = row.get('api_version_saved') or api_version_saved
            token_name_saved = row.get('token_name_saved')
            token_secret_saved = row.get('token_secret_saved')
            site_name_saved = row.get('site_name_saved') or site_name_saved
        except Exception:
            pass
    return cred_path, server_saved, api_version_saved, token_name_saved, token_secret_saved, site_name_saved


def render_configure_page(selected_tool: str = 'Tableau'):
    """Render the configure UI for the given tool inside the current Streamlit page."""
    st.header(f"Configure {selected_tool}")

    cred_path, server_saved, api_version_saved, token_name_saved, token_secret_saved, site_name_saved = _load_saved_credentials()

    with st.form('tableau'):
        st.write('Provide Tableau connection details (personal access token)')
        server = st.text_input('Server', value=server_saved)
        api_version = st.text_input('API version', value=api_version_saved)
        token_name = st.text_input('Token name', value=token_name_saved)
        token_secret = st.text_input('Token secret', value=token_secret_saved)
        site_name = st.text_input('Site name', value=site_name_saved)
        remember = st.checkbox('Remember credentials (stores in Streamlit_application/credentials.csv)')
        submit = st.form_submit_button('Execute')

    if st.button('← Back to Tools'):
        st.session_state['page'] = 'choose_tool'
        if 'selected_tool' in st.session_state:
            del st.session_state['selected_tool']
        st.rerun()

    if submit:
        config = {
            'tableau_prod': {
                'server': server,
                'api_version': api_version,
                'personal_access_token_name': token_name,
                'personal_access_token_secret': token_secret,
                'site_name': site_name,
            }
        }

        if remember:
            try:
                dfw = pd.DataFrame({
                    'server_saved': [server],
                    'api_version_saved': [api_version],
                    'token_name_saved': [token_name],
                    'token_secret_saved': [token_secret],
                    'site_name_saved': [site_name],
                    'site_url_saved': ['']
                })
                os.makedirs(os.path.dirname(cred_path), exist_ok=True)
                dfw.to_csv(cred_path, index=False)
                st.success('Credentials saved')
            except Exception as e:
                st.error(f'Failed saving credentials: {e}')

        adapter_key = selected_tool.lower() if selected_tool else 'tableau'
        with st.spinner('Submitting execution to backend...'):
            try:
                r = requests.post(f'{BACKEND_URL}/reports/execute', json={'adapter': adapter_key, 'config': config}, timeout=60)
                r.raise_for_status()
                st.success('Execution requested successfully')
                result = r.json()
                st.json(result)

                # If backend returned file paths, show download links
                outputs = result.get('outputs', {}) if isinstance(result, dict) else {}
                for name, path in outputs.items():
                    if os.path.exists(path):
                        st.markdown(f"- `{name}`: [Download]({path})")

            except Exception as e:
                st.error(f'Execution failed: {e}')


if __name__ == '__main__':
    # Allow running this file directly for quick debugging
    st.set_page_config(page_title='bi4bi - Configure (debug)', layout='centered')
    render_configure_page('Tableau')


    merged style.css
    /* ============================================================ */
/* UNIFIED STYLES - Merged from style.css and styles.css */
/* ============================================================ */

/* ---- GLOBAL BACKGROUND & STREAMLIT DEFAULTS ---- */
html, body, .stApp {
    background-color: #ffffff !important;
}

.main .block-container,
section.main,
.stApp {
    background: #ffffff !important;
}

section.main {
    padding: 3rem 1rem;
}

section.main > div {
    padding-top: 0;
}

/* Hide Streamlit branding */
#MainMenu {
    visibility: hidden;
}

footer {
    visibility: hidden;
}

header {
    visibility: hidden;
}

/* ============================================================ */
/* LANDING PAGE STYLES (Home Page) */
/* ============================================================ */

/* Full height for vertical centering */
.main .block-container {
    min-height: 100vh;
    padding-top: 0;
    padding-bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    max-width: 100%;
}

.center-wrapper {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

/* Card = ONE div we control – strict RECTANGLE (sharp corners, no radius) */
.landing-card {
    background: #ffffff !important;
    border-radius: 0 !important;
    box-shadow: 0px !important;
    border: 1px solid rgba(0, 0, 0, 0.06) !important;
    padding: 5rem 5rem !important;
    max-width: 1060px !important;
    margin: 0 auto !important;
    text-align: center !important;
}

/* Title */
.landing-card .title {
    font-size: 4.5rem;
    font-weight: 700;
    color: #1a1a1a;
    margin: 0 0 2rem 0;
    line-height: 1.1;
}

/* Description */
.landing-card .desc {
    font-size: 1.5rem;
    color: #1a1a1a;
    line-height: 1.7;
    margin-bottom: 2.5rem;
    max-width: 1900px;
    margin-left: auto;
    margin-right: auto;
}

/* Begin button (link styled as button) – rectangle, black text */
.begin-btn {
    display: inline-block;
    background: linear-gradient(90deg, #ffd54f 0%, #ffb74d 50%, #ff8f00 100%) !important;
    color: #1a1a1a !important;
    font-size: 1.5rem;
    font-weight: 600;
    padding: 1.1rem 3.5rem;
    border-radius: 0 !important;
    border: none;
    box-shadow: 0 4px 20px rgba(255, 140, 0, 0.35);
    transition: 0.25s;
    text-decoration: none !important;
    cursor: pointer;
    margin-top: 0.5rem;
}

.begin-btn:hover {
    background: linear-gradient(90deg, #ffe082 0%, #ffcc80 50%, #ffa726 100%) !important;
    transform: scale(1.03);
    box-shadow: 0 6px 24px rgba(255, 140, 0, 0.4);
    color: #1a1a1a !important;
}

/* Footer */
.landing-card .footer {
    margin-top: 3rem;
    font-size: 1rem;
    color: #666666;
}

/* ============================================================ */
/* CHOOSE TOOL PAGE STYLES (Tool Selection Page) */
/* ============================================================ */

/* Shadow box container – wide so big equal containers fit */
.block-container {
    font-size: 18px;
    max-width: 4000px;
    margin: 0 auto;
    padding: 3rem 2.5rem;
    background: #ffffff;
    border-radius: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(0, 0, 0, 0.06);
    text-align: center;
}

/* Title – large, bold, centered */
h1 {
    text-align: center !important;
    color: #1a1a1a !important;
    font-weight: 700 !important;
    font-size: 2.5rem !important;
    margin-bottom: 2.5rem !important;
    letter-spacing: -0.02em;
    line-height: 1.2;
}

/* Every container = equal size, slightly reduced height */
.stButton {
    width: 100% !important;
    height: 120px !important;
    display: block !important;
}

/* Pill/capsule shape, left-to-right gradient, subtle glow */
.stButton > button {
    width: 140px !important;
    height: 60px !important;
    min-height: 120px !important;
    max-height: 120px !important;
    box-sizing: border-box !important;
    background: linear-gradient(90deg, #ffd54f 0%, #ffb74d 50%, #ff8f00 100%) !important;
    color: #1a1a1a !important;
    font-weight: 700 !important;
    font-size: 1.25rem !important;
    border: none !important;
    border-radius: 20px !important;
    margin-left: 170px;
    padding: 5px !important;
    box-shadow: 0 4px 20px rgba(255, 140, 0, 0.25), 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    transition: transform 0.2s, box-shadow 0.2s !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.stButton > button:hover {
    transform: translateY(-1px) !important;
    box-shadow: 0 6px 24px rgba(255, 140, 0, 0.35), 0 2px 10px rgba(0, 0, 0, 0.1) !important;
    background: linear-gradient(90deg, #ffe082 0%, #ffcc80 50%, #ffa726 100%) !important;
}

/* Strict equal grid: each column exactly 1/3 width, same padding, same row height */
div[data-testid="stHorizontalBlock"] {
    display: flex !important;
    width: 100% !important;
}

div[data-testid="stHorizontalBlock"] > div {
    flex: 1 1 0 !important;
    width: 0 !important;
    min-width: 0 !important;
    max-width: none !important;
}

div[data-testid="column"] {
    width: 100% !important;
    padding: 0.6rem !important;
    display: flex !important;
    justify-content: center !important;
    align-items: stretch !important;
}

/* Force each button cell to same height so rows are equal */
div[data-testid="column"] > div {
    width: 100% !important;
    min-height: 120px !important;
}
